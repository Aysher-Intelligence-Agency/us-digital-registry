<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SocialMedia &amp; Product Registry Landing Page</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet" />
    <link href="css/font-awesome.css" rel="stylesheet" />
    <link href="css/social-buttons.css" rel="icon" />
    <link href="css/bootstrap-theme.css" rel="stylesheet" />
    <link href="css/master.css" rel="stylesheet" />
    <link href="css/custom-token-input.css" rel="stylesheet" />


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
<body>
    
<div class="container">
  <div class="row">
    <!-- Nav tabs -->
    <h1>Search Mobile Demo</h1>
    <div class="col-sm-12">
      <ul class="nav nav-tabs" role="tablist">
        <li>
          <a href="#home" role="tab" data-toggle="tab">
            <i class="fa fa-home"></i> Social Media
          </a>
        </li>
        <li>
          <a href="#profile" role="tab" data-toggle="tab">
            <i class="fa fa-user"></i> URL Lookup
          </a>
        </li>
        <li  class="active">
          <a href="#messages" role="tab" data-toggle="tab">
            <i class="fa fa-envelope"></i> Mobile Products
          </a>
        </li>
      </ul>
      <!-- Tab panes -->
      <div class="tab-content">
        <div class="tab-pane fade active in" id="home">
          <div>Search Social Media verified Accounts, Start typing in the box.</div>
          
        </div>
        <div class="tab-pane fade" id="profile">
          <h2>URL Lookup</h2>
        </div>
        <div class="tab-pane fade active in" id="messages">
            <h2>Mobile Product Search</h2>
            <div class="input-group searchBox">
            <form>
              <input type="text" id="searchbox" class="form-control typeahead" placeholder="Start typing here">
              <span class="input-group-btn">
                <button type="submit" class="btn btn-default" type="button">Search</button>
              </span>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-sm-12">
      <div class="latestPostsContainer">
        <h4>Results</h4>
        <div id="media-collection">

        </div>
      </div>
    </div>
  </div>
</div>


<script id="mobile-app-template" type="text/x-handlebars-template">
  <div class="media">
    {{#if icon_url}}
    <a href="#" class="pull-left">
      <img src="{{icon_url}}" class="media-object img-rounded" style="height: 64px; width:64px" alt='' />
    </a>
    {{/if}}
    <div class="media-body text-overflow">
      <h4 class="media-heading">{{name}}</h4> 
      {{short_description}}
      <ul>
        {{#each versions}}
        <a href="{{store_url}}">{{platform}}</a>
        {{/each}}
      </ul>
    </div>
  </div>
</script>

<script id="social-media-template" type="text/x-handlebars-template">
  <div class="media">
    <div class="media-body text-overflow">
      <a href="{{service_url}}"><h4 class="media-heading">
      {{#if organization}}
        {{organization}}
      {{else}}
        {{service_display_name}}:{{service_url}}
      {{/if}}
      </h4></a>
      {{#each agencies}}
        {{name}}
      {{/each}}
    </div>
  </div>
</script>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="lib/bootstrap.min.js"></script>
    <script src="lib/tokeninput.js"></script>
    <script src="lib/handlebars-2.0.0.js"></script>
    <script>
      var source   = $("#mobile-app-template").html();
      var mobile_template = Handlebars.compile(source); 
      source   = $("#social-media-template").html();
      var social_media_template = Handlebars.compile(source); 

      $("#searchbox").tokenInput("http://localhost:3000/api/v1/mobile_apps/tokeninput.json", {
        crossDomain: false,
        tokenFormatter: function(item){
          return '<li>'+ item.name +'</li>';
        },
        tokenValue: "key"
      });

      $('form').submit(function(e){
        e.preventDefault();
        tokens = $("#searchbox").tokenInput("get");
        agencies = [];
        services = [];
        tags = []
        text = []
        console.log(tokens);
        for(var i=0; i < tokens.length; i ++){
          split_data = tokens[i]["key"].split("&&&");
          if(split_data[0].indexOf("agency")==0){
            agencies.push(split_data[1])
          }else if(split_data[0].indexOf("tag")==0){
            tags.push(split_data[1])
          }else if(split_data[0].indexOf("text")==0){
            text.push(split_data[1])
          }else{

          }
        }
        $.get("http://localhost:3000/api/v1/mobile_apps.json",{
          q: text.join(" "),
          agencies: agencies.join(","),
          tags: tags.join(",")
        }, function(data){
          for(var i =0; i<data.length; i++){
            $('#media-collection').append(mobile_template(data[i]));
          }
        })
      });
    </script>
</body>
</html>