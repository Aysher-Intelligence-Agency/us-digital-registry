<div class="row">
  <div class="col-sm-12 col-md-12 main">
    <h1 class="page-header">Galleries</h1>
    <div class="row placeholders">
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <div class="paginated-results">           
          <%= link_to "Export Results to CSV", "javascript:export_csv()", class: "pull-right export" %>
          <table class="table table-striped" id="data-tables">
          <thead>
          <tr>
            <th>Department</th>
            <th>Name</th>
            <th># Social Media Accounts</th>
            <th># Mobile Products</th>
            <th>Tags</th>
            <th>Status</th>
            <th>Updated At</th>
            <th class = "lastlinks">Actions</th>
          </tr>
          </thead>

          <tbody>
        
          </tbody>
          </table>
          <%= link_to "Export Results to CSV", "javascript:export_csv()", class: "pull-right export" %>
        </div>
      </div>
    </div>
  </div>
</div>

<%= form_tag galleries_export_admin_galleries_path(format: :csv), method: :post, class: 'hidden', id: "csv_export" do %>
  <%= hidden_field_tag :ids %>
<% end %>

<% content_for :additional_javascript do %>
  <script>
    // var tags = [];
    // $("#tag_tokens").tokenInput("/admin/official_tags/tokeninput.json", {
    //   crossDomain: false,
    //   prePopulate: tags,
    //   preventDuplicates: true
    // });
    var data_tables = null;
    $(document).ready(function() {
       data_tables = $('#data-tables').dataTable({
        "ajax" : {
          "url":"/admin/galleries.json"
        },
        "scrollY":        "400px",
        "columns": [
          { "data" : "agencies[, ]"},
          { "data" : "name"},
          { "data" : "outlet_count"},
          { "data" : "mobile_app_count"},
          { "data" : "tags[, ]"},
          { "data" : "status"},
          { "data" : "updated_at"},
          { "data" : "DT_RowId"}
        ],
        "columnDefs": [
          {
            "render": function(data,type,row){
              return '<a href="/admin/galleries/'+data+'"><i class = \"glyphicon glyphicon-info-sign\"></i></a><a href="/admin/galleries/'+data+'/edit"><i class = \"glyphicon glyphicon-pencil\"></i></a>';
            }, "targets":[7]
          }
        ],
        "order": [[ 4, "desc" ]],
        "initComplete": function(settings, json) {
          $('.export').show();
        },
        'sDom':'<"row"<"col-sm-12"lf>><"row"<"col-sm-12"ip>>rt<"row"<"col-sm-12"ip>><"row"<"col-sm-12"lf>>'});
    } );


    all_ids = "";
    function export_csv(){
      rows = $("#data-tables").dataTable().$('tr', {"filter":"applied"});
      all_ids = []
      for(var i =0; i<rows.length; i++){
        all_ids.push(rows[i].id);
      }
      $('#ids').val(all_ids.join(","));
      $('#csv_export').submit();
    }

    function add_tag(name){
      data_tables.fnFilter(name);
    }     

  </script>
<% end %>